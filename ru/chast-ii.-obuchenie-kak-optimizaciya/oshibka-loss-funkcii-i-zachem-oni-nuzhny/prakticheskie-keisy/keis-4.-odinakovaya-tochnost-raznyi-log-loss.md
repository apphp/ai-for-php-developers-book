# –ö–µ–π—Å 4. –û–¥–∏–Ω–∞–∫–æ–≤–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å ‚Äì —Ä–∞–∑–Ω—ã–π log loss

–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —á–∞—Å—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç—Å—è –º–µ—Ç—Ä–∏–∫–æ–π [accuracy](../../../vvedenie/glossarii.md#accuracy-tochnost-klassifikacii) ‚Äì –¥–æ–ª–µ–π –æ–±—ä–µ–∫—Ç–æ–≤, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–¥–µ–ª—å –¥–∞–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç. –≠—Ç–æ —É–¥–æ–±–Ω–æ, –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –∏... –æ–ø–∞—Å–Ω–æ. –í —ç—Ç–æ–º –∫–µ–π—Å–µ –º—ã –ø–æ–∫–∞–∂–µ–º —Å–∏—Ç—É–∞—Ü–∏—é, –≥–¥–µ –¥–≤–µ –º–æ–¥–µ–ª–∏ –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —Ç–æ—á–Ω–æ—Å—Ç—å, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –æ–¥–Ω–∞ –∏–∑ –Ω–∏—Ö –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ –ª—É—á—à–µ –∫–∞–∫ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω–∞—è –º–æ–¥–µ–ª—å, –∏ —ç—Ç–æ –≤–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ [loss-—Ñ—É–Ω–∫—Ü–∏—é](../../../vvedenie/glossarii.md#loss-funkciya-funkciya-poter).

#### –¶–µ–ª—å –∫–µ–π—Å–∞

–ü–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É:

* accuracy –Ω–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
* loss-—Ñ—É–Ω–∫—Ü–∏—è (–≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ log loss) –Ω–µ—Å—ë—Ç –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
* "—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏" –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∞—Å—Ç—å—é –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

#### –°—Ü–µ–Ω–∞—Ä–∏–π

–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º –±–∏–Ω–∞—Ä–Ω—É—é –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é. –ï—Å—Ç—å —á–µ—Ç—ã—Ä–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è —Å –∏—Å—Ç–∏–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏:

```php
$y = [1, 0, 1, 0];
```

–î–≤–µ –º–æ–¥–µ–ª–∏ –≤—ã–¥–∞—é—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –∫–ª–∞—Å—Å—É 1.

–ú–æ–¥–µ–ª—å A ‚Äì —É–≤–µ—Ä–µ–Ω–Ω–∞—è:

```php
$modelA = [0.9, 0.2, 0.9, 0.2];
```

–ú–æ–¥–µ–ª—å B ‚Äì –æ—Å—Ç–æ—Ä–æ–∂–Ω–∞—è:

```php
$modelB = [0.6, 0.4, 0.6, 0.4];
```

–ï—Å–ª–∏ –º—ã –ø—Ä–∏–º–µ–Ω–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä–æ–≥ 0.5, –æ–±–µ –º–æ–¥–µ–ª–∏ –¥–∞–¥—É—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã:

<table data-header-hidden><thead><tr><th width="119.2265625"></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>y</td><td>Model A</td><td>Model B</td><td>–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–π –∫–ª–∞—Å—Å</td></tr><tr><td>1</td><td>0.9</td><td>0.6</td><td>1</td></tr><tr><td>0</td><td>0.2</td><td>0.4</td><td>0</td></tr><tr><td>1</td><td>0.9</td><td>0.6</td><td>1</td></tr><tr><td>0</td><td>0.2</td><td>0.4</td><td>0</td></tr></tbody></table>

Accuracy —É –æ–±–µ–∏—Ö –º–æ–¥–µ–ª–µ–π —Ä–∞–≤–Ω–∞ 100%.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è log loss

–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –±–∏–Ω–∞—Ä–Ω—É—é log loss:

```php
function logLoss(array $y, array $p, float $eps = 1e-15): float {
    $loss = 0.0;
    $n = count($y);

    for ($i = 0; $i < $n; $i++) {
        $pi = max($eps, min(1 - $eps, $p[$i]));
        $loss += $y[$i] * log($pi) + (1 - $y[$i]) * log(1 - $pi);
    }

    return -$loss / $n;
}

echo "Log loss A: " . logLoss($y, $modelA) . PHP_EOL;
echo "Log loss B: " . logLoss($y, $modelB) . PHP_EOL;
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–º:

```
Log loss A: 0.164
Log loss B: 0.511
```

***

#### –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏–∑–æ—à–ª–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ

<br>

–û–±–µ –º–æ–¥–µ–ª–∏:

* —Å–¥–µ–ª–∞–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è;
* –ø–æ–ª—É—á–∏–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π accuracy;
* –≤—ã–≥–ª—è–¥—è—Ç ¬´—Ä–∞–≤–Ω–æ—Ü–µ–Ω–Ω—ã–º–∏¬ª, –µ—Å–ª–∏ —Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∞—Å—Å—ã.

<br>

–ù–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π:

* Model A –≥–æ–≤–æ—Ä–∏—Ç: ¬´–Ø –ø–æ—á—Ç–∏ —É–≤–µ—Ä–µ–Ω¬ª.
* Model B –≥–æ–≤–æ—Ä–∏—Ç: ¬´–Ø —Å–∫–æ—Ä–µ–µ –¥—É–º–∞—é, –Ω–æ –Ω–µ —Ä—É—á–∞—é—Å—å¬ª.

<br>

Log loss —É—á–∏—Ç—ã–≤–∞–µ—Ç —ç—Ç–æ —Ä–∞–∑–ª–∏—á–∏–µ.

***

#### –ü–æ—á–µ–º—É log loss —Å—á–∏—Ç–∞–µ—Ç Model A –ª—É—á—à–µ

<br>

Log loss ‚Äì —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –º–µ—Ä–∞ –æ—à–∏–±–∫–∏, –∞ —à—Ç—Ä–∞—Ñ –∑–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å.

<br>

–û–Ω:

* –ø–æ–æ—â—Ä—è–µ—Ç –≤—ã—Å–æ–∫—É—é —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –ø—Ä–∞–≤–∞;
* —Ä–µ–∑–∫–æ –Ω–∞–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –æ—à–∏–±–ª–∞—Å—å;
* –¥–µ–ª–∞–µ—Ç —á–µ—Å—Ç–Ω–æ—Å—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π —á–∞—Å—Ç—å—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

<br>

–í —ç—Ç–æ–º –∫–µ–π—Å–µ Model A:

* —É–≤–µ—Ä–µ–Ω–∞ –∏ –ø—Ä–∞–≤–∞;
* –ø–æ–ª—É—á–∞–µ—Ç –º–µ–Ω—å—à–∏–π loss.

<br>

Model B:

* –º–µ–Ω–µ–µ —É–≤–µ—Ä–µ–Ω–∞, —Ö–æ—Ç—è —Ç–æ–∂–µ –ø—Ä–∞–≤–∞;
* –ø–ª–∞—Ç–∏—Ç –∑–∞ —ç—Ç–æ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–º loss.

***

#### –ö–ª—é—á–µ–≤–æ–π –≤—ã–≤–æ–¥

<br>

Accuracy –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å:

<br>

> ¬´–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –º–æ–¥–µ–ª—å —É–≥–∞–¥–∞–ª–∞ –∫–ª–∞—Å—Å?¬ª

<br>

Log loss –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –¥—Ä—É–≥–æ–π –≤–æ–ø—Ä–æ—Å:

<br>

> ¬´–ù–∞—Å–∫–æ–ª—å–∫–æ –º–æ–∂–Ω–æ –¥–æ–≤–µ—Ä—è—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∞ –≤—ã–¥–∞—ë—Ç?¬ª

<br>

–î–≤–µ –º–æ–¥–µ–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ —Ç–æ—á–Ω—ã–º–∏, –Ω–æ –Ω–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ –ø–æ–ª–µ–∑–Ω—ã–º–∏.

***

#### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å–º—ã—Å–ª

<br>

–≠—Ç–æ—Ç –∫–µ–π—Å –æ–±—ä—è—Å–Ω—è–µ—Ç, –ø–æ—á–µ–º—É:

* –≤ –∑–∞–¥–∞—á–∞—Ö —Å–∫–æ—Ä–∏–Ω–≥–∞, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∏ —Ä–∏—Å–∫-–º–æ–¥–µ–ª–µ–π accuracy –ø–æ—á—Ç–∏ –±–µ—Å–ø–æ–ª–µ–∑–µ–Ω;
* loss-—Ñ—É–Ω–∫—Ü–∏—è ‚Äì —ç—Ç–æ —á–∞—Å—Ç—å –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–¥–∞—á–∏, –∞ –Ω–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–∞–ª—å;
* –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ ‚Äì —ç—Ç–æ –Ω–µ –ø–æ–±–æ—á–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç –º–æ–¥–µ–ª–∏, –∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

***

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–ª–µ–¥—É—é—â–∏–º –ª–æ–≥–∏—á–Ω—ã–º —à–∞–≥–æ–º –±—É–¥–µ—Ç:

* –∫–µ–π—Å ¬´–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π log loss ‚Äì —Ä–∞–∑–Ω—ã–π accuracy¬ª;
* –∏–ª–∏ —Å–≤—è–∑–∫–∞ —Å calibration / reliability diagram;
* –∏–ª–∏ –∫–æ—Ä–æ—Ç–∫–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∞—è –≤—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ ¬´–º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –∑–Ω–∞–µ—Ç, —á—Ç–æ –æ–Ω–∞ –Ω–µ —É–≤–µ—Ä–µ–Ω–∞¬ª.

<br>

–°–∫–∞–∂–∏, –∫—É–¥–∞ –∏–¥—ë–º –¥–∞–ª—å—à–µ üôÇ
