# Кейс 1. Оценка стоимости квартиры по параметрам

Этот кейс – классика, но не учебная абстракция. В таком виде он реально используется во внутренних сервисах агентств недвижимости, банков и девелоперов. Его легко объяснить бизнесу, он интуитивно понятен и при этом отлично показывает, как работает линейная модель на практике.

Мы попробуем решить задачу двумя способами: сначала «чистым» PHP, чтобы было видно всю математику, а затем с помощью готовой библиотеки.

### Суть кейса

Есть квартира, описанная набором числовых параметров. По этим параметрам нужно оценить её стоимость.

Мы используем следующие признаки:

* площадь квартиры в квадратных метрах
* этаж
* расстояние до центра города в километрах
* возраст дома в годах

Цель – предсказать цену квартиры в рублях.

С точки зрения машинного обучения это обычная задача регрессии: по вектору признаков нужно предсказать одно числовое значение.

### Почему это хороший кейс

Во-первых, его легко обсуждать с бизнесом. Любой человек интуитивно понимает, что цена квартиры растёт с увеличением площади и падает с удалением от центра.

Во-вторых, линейность здесь часто оказывается достаточным приближением. Да, реальный рынок сложнее, но для первичной оценки или внутренней аналитики линейная модель работает удивительно хорошо.

В-третьих, этот кейс позволяет интерпретировать веса модели. Например:

"+5000 ₽ за каждый дополнительный квадратный метр" или "−20000 ₽ за каждый километр от центра". Для бизнеса это огромный плюс по сравнению с "чёрным ящиком".

### Формализация задачи

Каждая квартира описывается вектором признаков:

$$
\mathbf{x} = (x_1, x_2, x_3, x_4)
$$



Где:

* $x\_1$ – площадь
* $x\_2$ – этаж
* $x\_3$ – расстояние до центра
* $x\_4$ – возраст дома

<br>

Модель линейной регрессии имеет вид:

<br>

\$$

\hat{y} = w\_1 x\_1 + w\_2 x\_2 + w\_3 x\_3 + w\_4 x\_4 + b

\$$

<br>

Здесь $\hat{y}$ – предсказанная цена квартиры.

<br>

#### Реализация на чистом PHP

<br>

Начнём с варианта без библиотек. Это полезно не для продакшена, а для понимания.

<br>

Мы будем использовать градиентный спуск, матрицу признаков $X$ размером $N \times 4$ и вектор весов $w$ длины 4. Bias добавим как дополнительный признак со значением 1.

<br>

**Подготовка данных**

```
<?php

// X: [площадь, этаж, расстояние до центра, возраст дома, bias]
$X = [
    [50, 3, 5, 10, 1],
    [70, 10, 3, 5, 1],
    [40, 2, 8, 30, 1],
];

$y = [
    6_000_000,
    9_500_000,
    4_500_000,
];
```

Теперь каждый объект – это вектор из пяти элементов, где последний отвечает за bias.

<br>

**Вспомогательные функции**

```
function dot(array $a, array $b): float {
    $sum = 0.0;
    foreach ($a as $i => $v) {
        $sum += $v * $b[$i];
    }
    return $sum;
}
```

**Обучение модели**

```
$weights = array_fill(0, 5, 0.0);
$learningRate = 0.000001;
$epochs = 5000;

$n = count($X);
$m = count($weights);

for ($epoch = 0; $epoch < $epochs; $epoch++) {
    $gradients = array_fill(0, $m, 0.0);

    for ($i = 0; $i < $n; $i++) {
        $prediction = dot($weights, $X[$i]);
        $error = $y[$i] - $prediction;

        for ($j = 0; $j < $m; $j++) {
            $gradients[$j] += -2 * $X[$i][$j] * $error;
        }
    }

    for ($j = 0; $j < $m; $j++) {
        $weights[$j] -= $learningRate * ($gradients[$j] / $n);
    }
}
```

Этот код буквально реализует формулы градиентного спуска. Здесь нет оптимизаций, масштабирования признаков или трюков для ускорения – и это осознанно.

<br>

**Предсказание цены**

```
$newApartment = [60, 5, 4, 12, 1];
$predictedPrice = dot($weights, $newApartment);

echo "Оценка стоимости: " . round($predictedPrice) . " ₽\n";
```

**Плюсы и минусы подхода**

Плюс в том, что у нас полный контроль и прозрачность. Видно, как считаются градиенты, как обновляются веса и как формируется предсказание.

<br>

Минусы тоже очевидны. Нет масштабирования признаков, из-за чего обучение нестабильно. На больших датасетах такой код будет работать медленно. Поддержка и развитие такого решения в продакшене – отдельная задача.

<br>

#### Реализация с библиотекой PHP-ML

<br>

Теперь сделаем то же самое, но так, как это обычно делается в реальных проектах.

<br>

Устанавливаем библиотеку:

```
composer require php-ai/php-ml
```

Используем линейную регрессию методом наименьших квадратов.

```
<?php

use Phpml\Regression\LeastSquares;

$samples = [
    [50, 3, 5, 10],
    [70, 10, 3, 5],
    [40, 2, 8, 30],
];

$targets = [
    6_000_000,
    9_500_000,
    4_500_000,
];

$regression = new LeastSquares();
$regression->train($samples, $targets);

$price = $regression->predict([60, 5, 4, 12]);

echo "Оценка стоимости: " . round($price) . " ₽\n";
```

Здесь библиотека сама решает задачу оптимизации и подбирает веса аналитически.

<br>

#### Интерпретация весов

<br>

Самое ценное в линейной модели – интерпретируемость. Если посмотреть на полученные коэффициенты, можно сказать, например:

* каждый дополнительный квадратный метр увеличивает цену примерно на X рублей
* каждый километр от центра уменьшает цену примерно на Y рублей
* возраст дома оказывает отрицательное влияние

<br>

Именно за это линейные модели любят аналитики и бизнес, даже в эпоху нейросетей.

<br>

#### Выводы по кейсу

<br>

Этот кейс показывает, что машинное обучение – это не обязательно сложные модели и GPU. Часто достаточно простой линейной регрессии, чтобы получить полезный, объяснимый и применимый результат.

<br>

Важно понимать ограничения модели, но не менее важно уметь быстро и честно решить задачу, которая действительно возникает в бизнесе. Линейная регрессия в таких задачах остаётся одним из самых сильных инструментов – именно благодаря своей простоте и прозрачности.

<br>

В следующих кейсах мы будем постепенно усложнять модели, сохраняя эту практическую направленность.









\================





















### 1. **«Оценка стоимости квартиры по параметрам»**

#### Суть кейса

Классический, но реальный: внутренний сервис для агентства недвижимости или банка.

**Признаки:**

* площадь (м²)
* этаж
* расстояние до центра (км)
* возраст дома (лет)

**Цель:**\
Предсказать цену квартиры.

#### Почему это хороший кейс

* легко объяснить бизнесу
* линейность часто _достаточно хороша_
* можно показать интерпретацию весов (`+5000 ₽ за м²`, `−20000 ₽ за км`)

#### Реализация

**Pure PHP**

* градиентный спуск
* матрица `X (Nx4)`
* веса `w (4)`
* bias как дополнительный признак

Плюс:

* полный контроль
* видно математику

Минус:

* нет масштабирования признаков
* медленно на больших данных

**PHP + библиотека**

**php-ai/php-ml**

```bash
composer require php-ai/php-ml
```

```php
use Phpml\Regression\LeastSquares;

$samples = [
    [50, 3, 5, 10],
    [70, 10, 3, 5],
    [40, 2, 8, 30],
];

$targets = [6_000_000, 9_500_000, 4_500_000];

$regression = new LeastSquares();
$regression->train($samples, $targets);

$price = $regression->predict([60, 5, 4, 12]);
```
